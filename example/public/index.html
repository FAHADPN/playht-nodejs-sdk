<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PlayHT API Examples</title>
  </head>
  <body>
    <h1>PlayHT API Examples</h1>

    <h2>Ultra-Realistic Voices API (v2)</h2>
    <div><label>Enter text to generate:</label></div>
    <div><textarea id="v2TextToGenerate">I can speak now</textarea></div>
    <div><button onclick="generateV2Click()">Generate Audio</button></div>
    <audio id="v2AudioPlayer" controls>Your browser does not support the audio element.</audio>
    <hr />
    <h2>Stream Ultra-Realistic Voices API (v2)</h2>
    <div><label>Enter text to stream:</label></div>
    <div><textarea id="v2StreamTextToGenerate">Stream this now please</textarea></div>
    <div><button onclick="generateV2StreamClick()">Generate Audio</button></div>
    <audio id="v2StreamAudioPlayer" controls>Your browser does not support the audio element.</audio>
    <hr />
    <h2>Standard and Premium voices API (v1)</h2>
    <div><label>Enter text to generate:</label></div>
    <div><textarea id="v1TextToGenerate">Tell me what to say</textarea></div>
    <div><button onclick="generateV1Click()">Generate Audio</button></div>
    <audio id="v1AudioPlayer" controls>Your browser does not support the audio element.</audio>
    <hr />
    <h2>Stream Standard and Premium voices API (v1)</h2>
    <div><label>Enter text to generate:</label></div>
    <div>
      <textarea id="v1StreamTextToGenerate">
The clear, babbling stream meandered through the lush, sunlit meadow.</textarea
      >
    </div>
    <div><button onclick="generateV1StreamClick()">Generate Audio</button></div>
    <audio id="v1StreamAudioPlayer" controls>Your browser does not support the audio element.</audio>

    <script>
      function generateV2Click(event) {
        const text = document.getElementById('v2TextToGenerate').value;
        requestGeneration('/ttsV2', text, 'v2AudioPlayer');
      }

      function generateV2StreamClick(event) {
        const text = document.getElementById('v2StreamTextToGenerate').value;
        const searchParams = new URLSearchParams();
        searchParams.set('text', text);
        playUrl(`/streamV2?${searchParams.toString()}`, 'v2StreamAudioPlayer');
      }

      function generateV1Click(event) {
        const text = document.getElementById('v1TextToGenerate').value;
        requestGeneration('/ttsV1', text, 'v1AudioPlayer');
      }

      function generateV1StreamClick(event) {
        const text = document.getElementById('v1StreamTextToGenerate').value;
        const searchParams = new URLSearchParams();
        searchParams.set('text', text);
        playUrl(`/streamV1?${searchParams.toString()}`, 'v1StreamAudioPlayer');
      }

      function requestGeneration(apiURL, text, audioPlayerId) {
        const options = {
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            text,
          }),
          method: 'POST',
        };

        fetch(apiURL, options)
          .then((response) => {
            if (response.ok) {
              return response.json();
            } else {
              throw new Error(response.statusText);
            }
          })
          .then((json) => {
            const url = json?.url || Array.isArray(json?.audioUrl) ? json?.audioUrl?.[0] : json?.audioUrl;
            playUrl(url, audioPlayerId);
          })
          .catch((error) => {
            if (error.message) {
              alert(error.message);
            } else {
              alert('Error while contacting the API: ' + error);
            }
          });
        return true;
      }

      function playUrl(audioSourceUrl, audioElementId) {
        const audio = document.getElementById(audioElementId);

        audio.pause();
        audio.currentTime = 0;

        const existingSource = audio.querySelector('source');
        if (existingSource) {
          audio.removeChild(existingSource);
        }

        const source = document.createElement('source');
        source.src = audioSourceUrl;
        source.type = 'audio/mpeg';

        audio.appendChild(source);
        audio.load();

        audio.addEventListener('canplaythrough', () => {
          audio.play();
        });
      }
    </script>
  </body>
</html>
